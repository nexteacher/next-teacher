# 创建新导师默认地区功能

## 功能说明

当用户创建新导师时，新导师的地区会自动设置为用户当前选择的地区。

## 实现细节

### 1. 前端修改 (`app/page.tsx`)

#### a. 传递当前地区到创建请求

在 `handleCreateTeacher` 函数中，添加了 `region` 字段：

```typescript
const payload: Record<string, unknown> = {
  name: createForm.name.trim(),
  university: createForm.university.trim(),
  region: currentRegion.code, // 使用当前选择的地区
  source: 'user',
  isActive: true,
};
```

#### b. 对话框中添加地区提示

在创建导师对话框中添加了蓝色提示框，告知用户新导师将被创建在哪个地区：

```tsx
<div className="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md">
  <div className="flex items-start gap-2">
    <span className="text-blue-600 text-sm">📍</span>
    <div className="text-sm text-blue-700">
      <span className="font-medium">创建地区：</span>
      <span className="ml-1">{currentRegion.name}</span>
      <div className="text-xs text-blue-600 mt-1">
        新导师将被创建在当前选择的地区中
      </div>
    </div>
  </div>
</div>
```

### 2. 后端处理 (`app/api/teachers/route.ts`)

POST API 接收前端传来的 `region` 字段，通过 Mongoose 模型保存：

```typescript
// 创建新导师
const teacher = new TeacherModel(processedTeacherData);
await teacher.save();
```

由于 `processedTeacherData` 包含了前端传来的 `region` 值，新导师会使用该值。如果前端没有传 `region`，模型会使用默认值 'CN'。

## 用户体验流程

```
1. 用户选择地区（如"日本"）
   ↓
2. 页面显示："当前地区：日本 (X 位教师)"
   ↓
3. 用户点击"创建新导师"按钮
   ↓
4. 对话框显示："创建地区：日本"
   ↓
5. 用户填写导师信息
   ↓
6. 提交创建请求，包含 region: 'JP'
   ↓
7. 新导师被创建在日本地区
   ↓
8. 创建成功后，用户可以在日本地区的列表中看到新导师
```

## 界面展示

### 创建对话框顶部提示

```
┌────────────────────────────────────────┐
│ 创建新导师                        × │
├────────────────────────────────────────┤
│ ┌────────────────────────────────────┐ │
│ │ 📍 创建地区：日本                  │ │
│ │    新导师将被创建在当前选择的地区中  │ │
│ └────────────────────────────────────┘ │
│                                        │
│ 姓名（必填）                           │
│ [__________________]                   │
│                                        │
│ 大学（必填）                           │
│ [__________________]                   │
│                                        │
│ ...                                    │
└────────────────────────────────────────┘
```

## 测试步骤

### 场景 1：创建中国大陆地区的导师

1. 选择地区为"中国大陆"
2. 点击"创建新导师"
3. 填写导师信息（如：张三、清华大学）
4. 提交创建
5. 验证新导师的 region 为 'CN'
6. 在中国大陆地区列表中可以找到该导师

### 场景 2：创建日本地区的导师

1. 选择地区为"日本"
2. 点击"创建新导师"
3. 对话框显示"创建地区：日本"
4. 填写导师信息（如：山田太郎、東京大学）
5. 提交创建
6. 验证新导师的 region 为 'JP'
7. 切换到日本地区，可以看到新创建的导师

### 场景 3：切换地区后创建

1. 当前在"中国大陆"地区
2. 切换到"美国"地区
3. 点击"创建新导师"
4. 对话框显示"创建地区：美国"
5. 填写导师信息（如：John Smith、MIT）
6. 提交创建
7. 新导师被创建在美国地区
8. 只有在美国地区才能看到该导师

## 数据验证

使用 MongoDB 查询验证：

```javascript
// 查询某个地区的导师
db.teachers.find({ region: 'JP', name: '山田太郎' })

// 统计各地区的导师数量
db.teachers.aggregate([
  { $group: { _id: '$region', count: { $sum: 1 } } },
  { $sort: { count: -1 } }
])
```

## 注意事项

1. **地区不可为空**
   - region 字段在模型中有默认值 'CN'
   - 前端总是会传递当前选择的地区
   - 即使前端出错，后端也会有默认值

2. **创建后的地区不可变更**
   - 用户创建导师时就确定了地区
   - 如需更改，需要在导师详情页编辑

3. **地区过滤**
   - 新创建的导师只在其所属地区可见
   - 切换到其他地区将看不到该导师
   - 这是预期的行为，保证了数据的地区隔离

## 相关文件

- `app/page.tsx` - 首页创建导师功能（修改）
- `app/api/teachers/route.ts` - 创建导师 API（无需修改，自动处理）
- `models/Teacher.ts` - 教师模型（已有 region 字段）
- `components/RegionSelector.tsx` - 地区选择器组件

## 未来改进

1. **允许创建时选择其他地区**
   - 在创建对话框中添加地区选择器
   - 默认为当前地区，但允许用户修改

2. **批量导入时指定地区**
   - 导入数据时可以为所有导师指定地区
   - 或根据大学名称自动判断地区

3. **地区迁移功能**
   - 允许管理员将导师从一个地区迁移到另一个地区
   - 需要管理员权限和签名验证

## 常见问题

### Q: 为什么创建的导师在列表中看不到？
A: 可能是因为当前选择的地区和创建时的地区不同。切换到创建时的地区即可看到。

### Q: 可以创建多个地区的导师吗？
A: 可以。切换地区后创建的新导师将属于新的地区。

### Q: 旧的导师数据怎么办？
A: 通过迁移脚本，所有旧导师都已设置为 'CN'（中国大陆）。

### Q: 如何验证导师的地区？
A: 在导师详情页可以看到地区信息（显示为 📍 地区名）。

